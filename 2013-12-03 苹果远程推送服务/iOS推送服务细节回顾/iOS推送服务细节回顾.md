# iOS推送服务细节回顾

### 发布于2014-03-06 16:31

之前在做推送功能时候，就总结过一系列证书的制作，OC代码实现和服务器搭建等经验。又过了一段时间了，前前后后对推送服务做了多次的完善和优化，有iOS客户端的，还有本地服务器端的。现在就一些细节再回顾一下，也是对此前总结的补充。

## 远程消息推送的注册提示

第一次安装需要注册远程推送服务的App，都会收到设备的征询许可提示。但是以后无论是升级还是卸载后重新安装App，都是不会收到提示的，只能进入隐私设置里面关闭或者打开。想要彻底删除接收通知的设置？有一种说法：需要卸载App至少一天，iOS会自己清除用户该App的隐私中通知设置。

## 远程消息推送内容格式

这是容易忽略的地方。一般来说，AppDelegate中接收到远程通知的userInfo是可以根据开发者需要自由设置的，比如传递一些特殊内容，但是需要注意，iOS系统只会在意特定KV值：“aps”、“alert”、“badge”、“sound”。我在Cocoachina上看到一个朋友的提问，说是推送了“name”之类的参数，当App运行在前台时收到了，当App运行在后台时无法收到。其实就是这个道理，iOS收到了推送通知，但是无法识别特定KV值，只是他采用了将收到的消息通过本地通知方式显示在通知中心，当然只有在前台才会运行相应逻辑代码。

## 本地通知

UILocalNotification提供了本地通知提醒。例如上面所述，你可以在接受到远程通知后，采用本地通知来展示。本地通知的好处在于，可以自定义一些定时定频率的提醒通知，不受网络限制；可以设置通知的名称，后续可以根据该命名来特殊处理。而远程推送通知就没有这个待遇了。

## 通知中心的细节

在通知中心里面，我们可以看到不同App的多条推送通知。但是当想删除通知时候，只能以App为单元删除，不能逐条删除。这也要结合到第三条说到的细节。本地推送通知可以根据notification参数来cancel掉通知中心特定的通知，但是远程推送通知只有删除all或者等待用户自己删除。

而想要清除所有通知提示，可以通过设置全局UIApplication的applicationIconBadgeNumber属性来实现。改变其值为0即可；但是如果已经为0了，则需要先置为非零值，比如1，然后再置为0即可实现。

点击通知中心的远程推送消息后，会触发AppDelegate中一个代理方法，将应用在后台时候，收到的推送数据，传送到应用内。

## ApplicationIconBadgeNumber和sound

当App在后台时候，代码一般是不会执行的，所以只有指望iOS根据特定推送KV值来行动，比如alert、badge和sound。当然这些值是可以在自己的推送服务器上设置的。如果推送的sound文件不存在，可以在代码里面设置的AudioServicePlaySystemSound(1106)，也就是iOS那熟悉的一个信息提示音。